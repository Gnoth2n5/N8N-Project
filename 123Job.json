{
  "name": "123Job",
  "nodes": [
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM",
          "mode": "list",
          "cachedResultName": "123Job",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2020572363,
          "mode": "list",
          "cachedResultName": "list link tuy·ªÉn d·ª•ng ",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit#gid=2020572363"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5696,
        3936
      ],
      "id": "d052902d-b298-4bdc-b634-76180dacd9fe",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        5152,
        3920
      ],
      "id": "7f0c9005-c0e1-45f1-90ed-d32b35efc559",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM",
          "mode": "list",
          "cachedResultName": "123Job",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1293046103,
          "mode": "list",
          "cachedResultName": "danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit#gid=1293046103"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4624,
        3152
      ],
      "id": "9b4ede01-472e-47ee-a6fd-b8d57dc606e4",
      "name": "X√≥a danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM",
          "mode": "list",
          "cachedResultName": "123Job",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "list url c·∫ßn crawl",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4624,
        3504
      ],
      "id": "f1969ff9-75be-4c85-990a-4eaf225d5e4c",
      "name": "L·∫•y ƒë·ªØ li·ªáu sheet list url c·∫ßn crawl",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "runCustomScript",
        "scriptCode": "// --- Helper ---\nconst sleep = (ms) => new Promise((res) => setTimeout(res, ms));\n\n// --- L·∫§Y LINK ƒê·∫¶U V√ÄO ---\nlet baseUrl = $json.Url?.trim();\nif (!baseUrl) throw new Error(\"‚ùå Thi·∫øu 'Url' trong input!\");\n\nlet major = $json.Major || $json.major || \"\";\n\n// üü© GI·ªöI H·∫†N ƒê·ªÇ TR√ÅNH CRAWL QU√Å NHI·ªÄU\nconst MAX_PAGES = parseInt($json.MaxPages || $json.maxPages || \"5\"); // M·∫∑c ƒë·ªãnh 5 trang\nconst MAX_JOBS = parseInt($json.MaxJobs || $json.maxJobs || \"10\"); // M·∫∑c ƒë·ªãnh 10 job\n\nlet allJobs = [];\nlet currentPage = 1;\n\n// üü© T·ªëi ∆∞u: Ch·∫∑n request kh√¥ng c·∫ßn thi·∫øt ƒë·ªÉ tƒÉng t·ªëc\nawait $page.setRequestInterception(true);\n$page.on(\"request\", (req) => {\n  const t = req.resourceType();\n  const u = req.url();\n  if (\n    [\"image\", \"font\", \"media\"].includes(t) ||\n    /doubleclick|googletagmanager|analytics|facebook|adsystem|adservice|hotjar|mixpanel/i.test(u)\n  ) return req.abort();\n  req.continue();\n});\n\nwhile (true) {\n  // --- T·∫†O LINK PH√ÇN TRANG ---\n  let Url = baseUrl;\n  if (currentPage > 1) {\n    Url = baseUrl.includes(\"?\")\n      ? `${baseUrl}&page=${currentPage}`\n      : `${baseUrl}?page=${currentPage}`;\n  }\n\n  console.log(`üü¶ ƒêang x·ª≠ l√Ω trang ${currentPage}: ${Url}`);\n\n  // --- ƒêI ƒê·∫æN TRANG ---\n  await $page.goto(Url, { waitUntil: \"domcontentloaded\", timeout: 30000 });\n\n  // --- ƒê·ª¢I JOB HI·ªÜN RA (123job.vn selectors) ---\n  try {\n    await $page.waitForSelector(\".job_list-item, .job-item, .job-list-item, .job-card, [class*='job'], a[href*='/job/'], a[href*='/viec-lam']\", { timeout: 15000 });\n  } catch {\n    console.log(`‚ö†Ô∏è Kh√¥ng th·∫•y job ·ªü trang ${currentPage}, d·ª´ng l·∫°i.`);\n    break;\n  }\n\n  // --- CU·ªòN ƒê·ªÇ LOAD H·∫æT JOB (T·ªêI ∆ØU) ---\n  let lastCount = 0;\n  let noChangeCount = 0;\n  for (let i = 0; i < 10; i++) {\n    await $page.evaluate(() => window.scrollBy(0, document.body.scrollHeight));\n    await sleep(500);\n    const currentCount = await $page.$$eval(\n      \".job_list-item, .job-item, .job-list-item, .job-card, [class*='job'], a[href*='/job/'], a[href*='/viec-lam']\",\n      (els) => els.length\n    );\n    if (currentCount === lastCount) {\n      noChangeCount++;\n      if (noChangeCount >= 2) break;\n    } else {\n      noChangeCount = 0;\n    }\n    lastCount = currentCount;\n  }\n\n  // --- L·∫§Y D·ªÆ LI·ªÜU (123job.vn) ---\n  const jobsOnPage = await $page.evaluate(() => {\n    // Th·ª≠ nhi·ªÅu selector ph·ªï bi·∫øn cho 123job.vn\n    const selectors = [\n      \".job-item a[href*='/job/'], .job-item a[href*='/viec-lam']\",\n      \".job-list-item a[href*='/job/'], .job-list-item a[href*='/viec-lam']\",\n      \".job-card a[href*='/job/'], .job-card a[href*='/viec-lam']\",\n      \"a[href*='/job/']:not([href*='#'])\",\n      \"a[href*='/viec-lam']:not([href*='#'])\",\n      \"h2 a[href*='/job/'], h3 a[href*='/job/']\",\n      \".title a[href*='/job/'], .job-title a[href*='/job/']\"\n    ];\n    \n    let jobItems = [];\n    for (const sel of selectors) {\n      const items = document.querySelectorAll(sel);\n      if (items.length > 0) {\n        jobItems = Array.from(items);\n        break;\n      }\n    }\n    \n    // N·∫øu kh√¥ng t√¨m th·∫•y, th·ª≠ t√¨m t·∫•t c·∫£ link c√≥ ch·ª©a /job/ ho·∫∑c /viec-lam/\n    if (jobItems.length === 0) {\n      const allLinks = document.querySelectorAll(\"a[href]\");\n      jobItems = Array.from(allLinks).filter(link => {\n        const href = link.href || \"\";\n        return (href.includes(\"/job/\") || href.includes(\"/viec-lam/\")) && !href.includes(\"#\");\n      });\n    }\n    \n    // Lo·∫°i b·ªè duplicate v√† l·∫•y th√¥ng tin (k√®m l∆∞∆°ng) - D·ª±a tr√™n HTML structure th·ª±c t·∫ø\n    const uniqueJobs = new Map();\n    jobItems.forEach((item) => {\n      const link = item.href || item.getAttribute(\"href\") || \"\";\n      if (!link || link.includes(\"#\")) return;\n      \n      let fullUrl = link;\n      if (link.startsWith(\"/\")) {\n        fullUrl = \"https://123job.vn\" + link;\n      }\n      \n      const title = item.textContent?.trim() || item.querySelector(\"h2, h3, .title, .job-title, .job_list-item-title\")?.textContent?.trim() || \"\";\n      \n      // T√¨m job item cha ƒë·ªÉ l·∫•y l∆∞∆°ng (∆∞u ti√™n .job_list-item)\n      let salary = null;\n      let jobCard = item.closest(\".job_list-item, .job-item, .job-list-item, .job-card, [class*='job-item'], [class*='job-card'], [class*='job_list']\");\n      if (jobCard) {\n        // T√¨m l∆∞∆°ng trong .job_list-item-info .salary (theo HTML structure th·ª±c t·∫ø)\n        const jobInfo = jobCard.querySelector(\".job_list-item-info, .job-item-info, [class*='info']\");\n        if (jobInfo) {\n          const salaryEl = jobInfo.querySelector(\".salary[title='M·ª©c l∆∞∆°ng vi·ªác l√†m'], .salary, .job-salary, [class*='salary'], .wage, [class*='wage'], [class*='luong'], [class*='muc-luong'], .info-salary\");\n          if (salaryEl) {\n            salary = salaryEl.textContent?.trim() || null;\n          }\n        }\n        // Fallback: t√¨m tr·ª±c ti·∫øp trong job card\n        if (!salary) {\n          const salaryEl = jobCard.querySelector(\".salary[title='M·ª©c l∆∞∆°ng vi·ªác l√†m'], .salary, .job-salary, [class*='salary'], .wage, [class*='wage'], [class*='luong'], [class*='muc-luong'], .info-salary\");\n          if (salaryEl) {\n            salary = salaryEl.textContent?.trim() || null;\n          }\n        }\n        // N·∫øu kh√¥ng t√¨m th·∫•y, t√¨m text ch·ª©a $ ho·∫∑c l∆∞∆°ng\n        if (!salary) {\n          const text = jobCard.textContent || \"\";\n          const salaryMatch = text.match(/(\\$[^\\n]*|ƒëang c·∫≠p nh·∫≠t|kh√¥ng x√°c ƒë·ªãnh|th·ªèa thu·∫≠n|flex)/i);\n          if (salaryMatch) {\n            salary = salaryMatch[0];\n          }\n        }\n      }\n      \n      if (fullUrl && !uniqueJobs.has(fullUrl)) {\n        uniqueJobs.set(fullUrl, { Url: fullUrl, title: title || \"Kh√¥ng c√≥ ti√™u ƒë·ªÅ\", salary: salary || \"\" });\n      }\n    });\n    \n    // L·ªçc b·ªè c√°c job c√≥ l∆∞∆°ng \"ƒëang c·∫≠p nh·∫≠t\", \"kh√¥ng x√°c ƒë·ªãnh\", \"flex\", \"th·ªèa thu·∫≠n\"\n    const filteredJobs = Array.from(uniqueJobs.values()).filter(job => {\n      if (!job.salary || job.salary.trim() === \"\") {\n        // N·∫øu kh√¥ng c√≥ l∆∞∆°ng, gi·ªØ l·∫°i ƒë·ªÉ check ·ªü loop 2\n        return true;\n      }\n      \n      const salaryLower = job.salary.toLowerCase().trim();\n      \n      // B·ªè qua n·∫øu ch·ªâ l√† s·ªë 0, r·ªóng, ho·∫∑c ch·ªâ c√≥ k√Ω hi·ªáu $\n      if (salaryLower === \"0\" || salaryLower === \"\" || salaryLower === \"$\" || salaryLower === \"$ \" || salaryLower === \"$\") {\n        return false;\n      }\n      \n      // Danh s√°ch t·ª´ kh√≥a c·∫ßn b·ªè qua (bao g·ªìm c√°c bi·∫øn th·ªÉ)\n      const skipKeywords = [\n        \"ƒëang c·∫≠p nh·∫≠t\", \n        \"c·∫≠p nh·∫≠t\", \n        \"ƒëang c·∫≠p nh·∫≠t\", \n        \"ƒëang c·∫≠p nh·∫≠t\", \n        \"kh√¥ng x√°c ƒë·ªãnh\", \n        \"th·ªèa thu·∫≠n\", \n        \"flex\", \n        \"flexible\",\n        \"updating\",\n        \"not specified\",\n        \"negotiable\"\n      ];\n      \n      // Ki·ªÉm tra n·∫øu l∆∞∆°ng ch·ª©a b·∫•t k·ª≥ t·ª´ kh√≥a n√†o\n      const shouldSkip = skipKeywords.some(keyword => salaryLower.includes(keyword));\n      \n      if (shouldSkip) {\n        console.log(`‚ö†Ô∏è B·ªè qua job c√≥ l∆∞∆°ng: ${job.salary}`);\n        return false;\n      }\n      \n      // Ch·ªâ gi·ªØ l·∫°i job c√≥ l∆∞∆°ng h·ª£p l·ªá (c√≥ s·ªë ti·ªÅn c·ª• th·ªÉ)\n      return true;\n    });\n    \n    return filteredJobs;\n  });\n\n  console.log(`‚úÖ Trang ${currentPage} c√≥ ${jobsOnPage.length} job`);\n  if (jobsOnPage.length === 0) break;\n\n  // --- G·∫ÆN SOURCE + MAJOR ---\n  const mappedJobs = jobsOnPage.map((j) => ({\n    Source: baseUrl,\n    Url: j.Url,\n    link: j.Url,\n    title: j.title,\n    Major: major\n  }));\n\n  allJobs.push(...mappedJobs);\n\n  // üü© KI·ªÇM TRA GI·ªöI H·∫†N S·ªê L∆Ø·ª¢NG JOB\n  if (allJobs.length >= MAX_JOBS) {\n    console.log(`üõë ƒê√£ ƒë·∫°t gi·ªõi h·∫°n ${MAX_JOBS} job, d·ª´ng l·∫°i!`);\n    allJobs = allJobs.slice(0, MAX_JOBS); // C·∫Øt b·ªõt n·∫øu v∆∞·ª£t qu√°\n    break;\n  }\n\n  // üü© KI·ªÇM TRA GI·ªöI H·∫†N S·ªê TRANG\n  if (currentPage >= MAX_PAGES) {\n    console.log(`üõë ƒê√£ ƒë·∫°t gi·ªõi h·∫°n ${MAX_PAGES} trang, d·ª´ng l·∫°i!`);\n    break;\n  }\n\n  // --- KI·ªÇM TRA XEM C√íN TRANG KH√îNG (123job.vn pagination) ---\n  const nextExists = await $page.evaluate(() => {\n    // Th·ª≠ nhi·ªÅu selector ph√¢n trang\n    return !!(\n      document.querySelector(\".pagination .next:not(.disabled)\") ||\n      document.querySelector(\".pagination a[aria-label='Next']\") ||\n      document.querySelector(\".pagination .page-item.active + .page-item:not(.disabled)\") ||\n      document.querySelector(\"a[href*='page=']:not([href*='page=1'])\") ||\n      document.querySelector(\".next-page, .pagination-next\")\n    );\n  });\n  \n  if (!nextExists) {\n    console.log(\"üõë H·∫øt trang, d·ª´ng!\");\n    break;\n  }\n\n  currentPage++;\n  await sleep(800);\n}\n\nconsole.log(\"üéØ T·ªïng s·ªë vi·ªác l√†m:\", allJobs.length);\n\n// Tr·∫£ v·ªÅ d·∫°ng array cho n8n\nreturn allJobs.map(job => ({ json: job }));",
        "options": {}
      },
      "type": "n8n-nodes-puppeteer.puppeteer",
      "typeVersion": 1,
      "position": [
        5184,
        3104
      ],
      "id": "6416ed30-5cfe-4abe-8756-58cac5618120",
      "name": "Truy c·∫≠p v√†o link l·∫•y ra c√¥ng vi·ªác",
      "alwaysOutputData": true,
      "executeOnce": false,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM",
          "mode": "list",
          "cachedResultName": "123Job",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1293046103,
          "mode": "list",
          "cachedResultName": "danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit#gid=1293046103"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "L∆∞∆°ng": "={{ $json[\"L∆∞∆°ng\"] }}",
            "Tr√¨nh ƒë·ªô": "={{ $json[\"Tr√¨nh ƒë·ªô\"] }}",
            "S·ªë l∆∞·ª£ng": "={{ $json[\"S·ªë l∆∞·ª£ng\"] }}",
            "Kinh nghi·ªám": "={{ $json[\"Kinh nghi·ªám\"] }}",
            "Ng√†y ƒëƒÉng": "={{ $json[\"Ng√†y ƒëƒÉng\"] }}",
            "V·ªã tr√≠": "={{ $json[\"V·ªã tr√≠\"] }}",
            "H·∫°n tuy·ªÉn d·ª•ng": "={{ $json[\"H·∫°n tuy·ªÉn d·ª•ng\"] }}",
            "Chuy√™n ng√†nh": "={{ $json[\"Chuy√™n ng√†nh\"] }}",
            "Ti√™u ƒë·ªÅ c√¥ng vi·ªác": "={{ $json[\"Ti√™u ƒë·ªÅ c√¥ng vi·ªác\"] }}",
            "T√™n c√¥ng ty": "={{ $json[\"T√™n c√¥ng ty\"] }}",
            "Link": "={{ $json.Link }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Ti√™u ƒë·ªÅ c√¥ng vi·ªác",
              "displayName": "Ti√™u ƒë·ªÅ c√¥ng vi·ªác",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "T√™n c√¥ng ty",
              "displayName": "T√™n c√¥ng ty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Link",
              "displayName": "Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "L∆∞∆°ng",
              "displayName": "L∆∞∆°ng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Tr√¨nh ƒë·ªô",
              "displayName": "Tr√¨nh ƒë·ªô",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "V·ªã tr√≠",
              "displayName": "V·ªã tr√≠",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Kinh nghi·ªám",
              "displayName": "Kinh nghi·ªám",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "S·ªë l∆∞·ª£ng",
              "displayName": "S·ªë l∆∞·ª£ng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Ng√†y ƒëƒÉng",
              "displayName": "Ng√†y ƒëƒÉng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "H·∫°n tuy·ªÉn d·ª•ng",
              "displayName": "H·∫°n tuy·ªÉn d·ª•ng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Chuy√™n ng√†nh",
              "displayName": "Chuy√™n ng√†nh",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6784,
        3200
      ],
      "id": "22fb8293-60c0-40d7-964a-abc5b8263314",
      "name": "Th√™m ƒë·ªØ li·ªáu v√†o sheet danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM",
          "mode": "list",
          "cachedResultName": "123Job",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2020572363,
          "mode": "list",
          "cachedResultName": "list link tuy·ªÉn d·ª•ng ",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit#gid=2020572363"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Url": "={{$json.link }}",
            "Source": "={{ $json.Url }}",
            "Major": "={{ $json.Major }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Source",
              "displayName": "Source",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Url",
              "displayName": "Url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Major",
              "displayName": "Major",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5680,
        3600
      ],
      "id": "f456c419-14c5-48c6-ae8d-048d28e4cf9b",
      "name": "Th√™m ƒë·ªØ li·ªáu v√†o sheet list link tuy·ªÉn d·ª•ng",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        6688,
        3488
      ],
      "id": "07df6375-08a7-4030-880a-bd474003d0a4",
      "name": "L·∫∑p l·∫°i x·ª≠ l√Ω",
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        4896,
        3504
      ],
      "id": "b0bbe34c-9b1c-4a80-8f12-9b749771e049",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM",
          "mode": "list",
          "cachedResultName": "123Job",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2020572363,
          "mode": "list",
          "cachedResultName": "list link tuy·ªÉn d·ª•ng ",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit#gid=2020572363"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4624,
        3312
      ],
      "id": "26a98216-c16d-4ba3-926f-66d4e0dbdeae",
      "name": "X√≥a ƒë·ªØ li·ªáu c·ªßa sheet list link tuy·ªÉn d·ª•ng",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "runCustomScript",
        "scriptCode": "// üü© B·ªçc to√†n b·ªô trong try-catch ƒë·ªÉ b·ªè qua link l·ªói\ntry {\n// üü© L·∫•y bi·∫øn t·ª´ input JSON\nconst { Url, Major } = $json;\n\n// üü© Chu·∫©n h√≥a URL\nlet jobUrl = (Url || \"\").trim();\nif (!jobUrl) {\n  console.log(\"‚ö†Ô∏è B·ªè qua: Kh√¥ng c√≥ URL h·ª£p l·ªá\");\n  return [   {     json: {       skip: true,       Link: jobUrl || \"\",       message: \"URL l·ªói, b·ªè qua\"     }   } ];\n}\nif (jobUrl.startsWith(\"/\")) jobUrl = \"https://123job.vn\" + jobUrl;\n\ntry {\n// üü© Th√™m User-Agent ƒë·ªÉ tr√°nh b·ªã ch·∫∑n\nawait $page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36');\n\n// üü© Th√™m extra headers\nawait $page.setExtraHTTPHeaders({\n  'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n  'Accept-Language': 'vi-VN,vi;q=0.9,en-US;q=0.8,en;q=0.7',\n  'Accept-Encoding': 'gzip, deflate, br',\n  'Connection': 'keep-alive',\n  'Upgrade-Insecure-Requests': '1'\n});\n\n// üü© Gi·∫£m t·∫£i request r√°c (T·ªêI ∆ØU)\nawait $page.setRequestInterception(true);\n$page.on(\"request\", (req) => {\n  const t = req.resourceType();\n  const u = req.url();\n  if (\n    [\"image\", \"font\", \"media\"].includes(t) ||\n    /doubleclick|googletagmanager|analytics|facebook|adsystem|adservice|hotjar|mixpanel/i.test(u)\n  ) return req.abort();\n  req.continue();\n});\n\n// üü© T·ª± ƒë·ªông ƒë√≥ng dialog/alert n·∫øu c√≥\ntry {\n  $page.on('dialog', async dialog => {\n    try {\n      await dialog.dismiss();\n    } catch (e) {}\n  });\n} catch (e) {}\n} catch (e) {\n  console.log(`‚ö†Ô∏è L·ªói khi setup page: ${e.message}`);\n}\n\n// üü© Delay tr∆∞·ªõc khi truy c·∫≠p ƒë·ªÉ tr√°nh b·ªã ch·∫∑n\nawait new Promise(r => setTimeout(r, 1000 + Math.random() * 2000));\n\n// üü© Retry logic v·ªõi exponential backoff\nlet retries = 3;\nlet lastError = null;\nlet pageLoaded = false;\nwhile (retries > 0) {\n  try {\n    // üü© Truy c·∫≠p trang v·ªõi timeout tƒÉng l√™n\n    await $page.goto(jobUrl, { \n      waitUntil: \"networkidle2\", \n      timeout: 60000 \n    });\n    pageLoaded = true;\n    break; // Th√†nh c√¥ng, tho√°t kh·ªèi retry loop\n  } catch (error) {\n    lastError = error;\n    retries--;\n    if (retries > 0) {\n      const delay = Math.pow(2, 3 - retries) * 2000; // 2s, 4s, 8s\n      console.log(`‚ö†Ô∏è L·ªói khi truy c·∫≠p ${jobUrl}, retry sau ${delay}ms... (c√≤n ${retries} l·∫ßn)`);\n      await new Promise(r => setTimeout(r, delay));\n    } else {\n      console.log(`‚ùå Kh√¥ng th·ªÉ truy c·∫≠p ${jobUrl} sau 3 l·∫ßn th·ª≠`);\n      // Th·ª≠ v·ªõi domcontentloaded n·∫øu networkidle2 fail\n      try {\n        await $page.goto(jobUrl, { waitUntil: \"domcontentloaded\", timeout: 30000 });\n        pageLoaded = true;\n      } catch (e) {\n        console.log(`‚ùå B·ªè qua link ${jobUrl} do l·ªói: ${lastError.message}`);\n        return [   {     json: {       skip: true,       Link: jobUrl || \"\",       message: \"URL l·ªói, b·ªè qua\"     }   } ]; // B·ªè qua link n√†y, ti·∫øp t·ª•c v·ªõi link kh√°c\n      }\n    }\n  }\n}\n\nif (!pageLoaded) {\n  console.log(`‚ùå Kh√¥ng th·ªÉ load trang ${jobUrl}`);\n  return [   {     json: {       skip: true,       Link: jobUrl || \"\",       message: \"URL l·ªói, b·ªè qua\"     }   } ];\n}\n\n// üü© Ch·ªù trang load ho√†n to√†n\ntry {\n  await new Promise(r => setTimeout(r, 2000));\n} catch (e) {\n  console.log(`‚ö†Ô∏è L·ªói khi delay: ${e.message}`);\n}\n\n// üü© ƒê√≥ng t·∫•t c·∫£ popup/modal ƒë·ªÉ tr√°nh ch·∫∑n scrape\ntry {\n  await $page.evaluate(() => {\n    try {\n      // ƒê√≥ng c√°c modal/popup ph·ªï bi·∫øn\n      const closeSelectors = [\n        '.modal .close',\n        '.modal button[aria-label*=\"close\" i]',\n        '.modal button[aria-label*=\"ƒë√≥ng\" i]',\n        '.popup .close',\n        '.popup button[aria-label*=\"close\" i]',\n        '[class*=\"modal\"] [class*=\"close\"]',\n        '[class*=\"popup\"] [class*=\"close\"]',\n        '.btn-close',\n        '[data-dismiss=\"modal\"]',\n        '[data-bs-dismiss=\"modal\"]',\n        '.close-modal',\n        '.close-popup'\n      ];\n      \n      let closed = 0;\n      closeSelectors.forEach(selector => {\n        try {\n          const elements = document.querySelectorAll(selector);\n          elements.forEach(el => {\n            if (el && el.offsetParent !== null) { // Ch·ªâ ƒë√≥ng n·∫øu visible\n              el.click();\n              closed++;\n            }\n          });\n        } catch (e) {}\n      });\n      \n      // ƒê√≥ng modal b·∫±ng c√°ch click v√†o backdrop\n      const backdrops = document.querySelectorAll('.modal-backdrop, .modal-overlay, [class*=\"backdrop\"], [class*=\"overlay\"]');\n      backdrops.forEach(backdrop => {\n        try {\n          if (backdrop && backdrop.offsetParent !== null) {\n            backdrop.style.display = 'none';\n            backdrop.remove();\n            closed++;\n          }\n        } catch (e) {}\n      });\n      \n      // ·∫®n c√°c modal b·∫±ng CSS\n      const modals = document.querySelectorAll('[class*=\"modal\"], [class*=\"popup\"], [id*=\"modal\"], [id*=\"popup\"]');\n      modals.forEach(modal => {\n        try {\n          if (modal && modal.offsetParent !== null) {\n            const style = window.getComputedStyle(modal);\n            if (style.display !== 'none' && style.visibility !== 'hidden') {\n              modal.style.display = 'none';\n              modal.style.visibility = 'hidden';\n              modal.style.opacity = '0';\n              closed++;\n            }\n          }\n        } catch (e) {}\n      });\n      \n      // X√≥a body class c√≥ th·ªÉ ch·∫∑n scroll\n      if (document.body) {\n        document.body.classList.remove('modal-open', 'popup-open', 'no-scroll');\n        document.body.style.overflow = '';\n        document.body.style.paddingRight = '';\n      }\n      \n      return closed;\n    } catch (e) {\n      return 0;\n    }\n  });\n  \n  // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ popup ƒë√≥ng ho√†n to√†n\n  await new Promise(r => setTimeout(r, 500));\n  \n  // Th·ª≠ ƒë√≥ng l·∫°i l·∫ßn n·ªØa ƒë·ªÉ ch·∫Øc ch·∫Øn\n  await $page.evaluate(() => {\n    try {\n      // T√¨m v√† ƒë√≥ng c√°c button c√≥ text \"ƒê√≥ng\", \"X\", \"Close\"\n      const allButtons = document.querySelectorAll('button, a, span, div');\n      allButtons.forEach(btn => {\n        const text = (btn.textContent || '').trim().toLowerCase();\n        if ((text === 'ƒë√≥ng' || text === 'x' || text === 'close' || text.includes('ƒë√≥ng')) && btn.offsetParent !== null) {\n          const parent = btn.closest('[class*=\"modal\"], [class*=\"popup\"], [id*=\"modal\"], [id*=\"popup\"]');\n          if (parent) {\n            try {\n              btn.click();\n            } catch (e) {}\n          }\n        }\n      });\n      \n      // ·∫®n t·∫•t c·∫£ modal c√≤n l·∫°i\n      const allModals = document.querySelectorAll('[class*=\"modal\"], [class*=\"popup\"]');\n      allModals.forEach(modal => {\n        if (modal && modal.offsetParent !== null) {\n          modal.style.display = 'none';\n          modal.style.visibility = 'hidden';\n          modal.style.opacity = '0';\n          modal.style.zIndex = '-1';\n        }\n      });\n    } catch (e) {}\n  });\n  \n  await new Promise(r => setTimeout(r, 300));\n} catch (e) {\n  console.log(`‚ö†Ô∏è L·ªói khi ƒë√≥ng popup: ${e.message}`);\n  // Ti·∫øp t·ª•c d√π c√≥ l·ªói\n}\n\n// üü© Ch·ªù ti√™u ƒë·ªÅ xu·∫•t hi·ªán (123job.vn selectors) - tƒÉng timeout\ntry {\n  await $page.waitForSelector(\"h1.job-title, h1.js-job, body\", { timeout: 30000 });\n} catch (e) {\n  console.log(\"‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y ti√™u ƒë·ªÅ, ti·∫øp t·ª•c...\");\n  // Ki·ªÉm tra xem c√≥ b·ªã redirect ho·∫∑c block kh√¥ng\n  try {\n    const currentUrl = $page.url();\n    if (currentUrl.includes('blocked') || currentUrl.includes('error') || currentUrl !== jobUrl) {\n      console.log(`‚ö†Ô∏è URL b·ªã thay ƒë·ªïi: ${currentUrl} (g·ªëc: ${jobUrl})`);\n    }\n  } catch (urlError) {\n    console.log(`‚ö†Ô∏è Kh√¥ng th·ªÉ l·∫•y URL hi·ªán t·∫°i: ${urlError.message}`);\n  }\n}\n\n// üü© M·ªü r·ªông c√°c ph·∫ßn Xem th√™m (123job.vn)\ntry {\n  for (let i = 0; i < 5; i++) {\n    const clicked = await $page.evaluate(() => {\n      try {\n        let c = 0;\n        const allButtons = document.querySelectorAll('button, a, span[onclick], div[onclick], .btn-collapse, .toggle-attr-item');\n        allButtons.forEach(btn => {\n          const text = btn.textContent?.toLowerCase() || '';\n          if (text.includes('xem th√™m') && btn.offsetParent && !btn.disabled) {\n            btn.click();\n            c++;\n          }\n        });\n        return c;\n      } catch (e) {\n        return 0;\n      }\n    });\n    if (!clicked) break;\n    await new Promise(r => setTimeout(r, 300));\n  }\n} catch (e) {\n  console.log(`‚ö†Ô∏è L·ªói khi m·ªü r·ªông Xem th√™m: ${e.message}`);\n}\n\n// üü© Cu·ªôn ƒë·ªÉ t·∫£i h·∫øt n·ªôi dung\ntry {\n  await $page.evaluate(async () => {\n    await new Promise(res => {\n      let y = 0;\n      const step = 1000;\n      const t = setInterval(() => {\n        window.scrollBy(0, step);\n        y += step;\n        if (y > document.body.scrollHeight + 1200) {\n          clearInterval(t);\n          res();\n        }\n      }, 80);\n    });\n  });\n  await new Promise(r => setTimeout(r, 300));\n} catch (e) {\n  console.log(`‚ö†Ô∏è L·ªói khi cu·ªôn trang: ${e.message}`);\n}\n\n// üü© Thu th·∫≠p d·ªØ li·ªáu ch√≠nh (123job.vn - TARGET ƒê√öNG HTML)\nlet job;\ntry {\n  job = await $page.evaluate((Major) => {\n  const get = (sel) => {\n    try {\n      const el = document.querySelector(sel);\n      return el?.textContent?.trim() || null;\n    } catch { return null; }\n  };\n  \n  // === H√†m t√¨m trong .attr-item theo .name-attr ===\n  const findByAttrItem = (nameLabels, defaultValue = null) => {\n    const attrItems = document.querySelectorAll(\".attr-item, .attr-item-groups .attr-item, #tab-attr .attr-item\");\n    for (const item of attrItems) {\n      const nameAttr = item.querySelector(\".name-attr\")?.textContent?.trim() || \"\";\n      for (const label of nameLabels) {\n        if (nameAttr.toLowerCase().includes(label.toLowerCase())) {\n          const textAttr = item.querySelector(\".text-attr\")?.textContent?.trim() || \"\";\n          if (textAttr && textAttr.length > 0) {\n            return textAttr;\n          }\n        }\n      }\n    }\n    return defaultValue;\n  };\n\n  // === L·∫•y ti√™u ƒë·ªÅ (h1.job-title strong) ===\n  const title = get(\"h1.job-title strong\") || get(\"h1.js-job.job-title strong\") || get(\"h1.job-title\") || get(\"h1\") || \"Kh√¥ng x√°c ƒë·ªãnh\";\n\n  // === L·∫•y t√™n c√¥ng ty (.company-name h2) ===\n  let company = get(\".company-name h2\") || get(\".company-info .company-name h2\") || get(\".company-info-mobile .text-bold\");\n  \n  // L√†m s·∫°ch t√™n c√¥ng ty\n  if (company) {\n    company = company.trim();\n    if (company.includes(\"Quy m√¥:\")) {\n      company = company.split(/Quy m√¥:|Tr·ª• s·ªü:/i)[0].trim();\n    }\n    if (company.includes(\"Tr·ª• s·ªü:\")) {\n      company = company.split(/Tr·ª• s·ªü:/i)[0].trim();\n    }\n  } else {\n    company = \"Kh√¥ng x√°c ƒë·ªãnh\";\n  }\n\n  // === L·∫•y l∆∞∆°ng (.attr-item-head .attr-item .value span v·ªõi icon la-money) ===\n  let salary = null;\n  const attrItemHead = document.querySelector(\".attr-item-head\");\n  if (attrItemHead) {\n    const attrItems = attrItemHead.querySelectorAll(\".attr-item\");\n    for (const item of attrItems) {\n      const icon = item.querySelector(\".icon-attr-header i\");\n      if (icon && icon.classList.contains(\"la-money\")) {\n        const valueEl = item.querySelector(\".value span\");\n        if (valueEl) {\n          salary = valueEl.textContent?.trim() || null;\n          break;\n        }\n      }\n    }\n  }\n  \n  // Fallback\n  if (!salary) {\n    salary = findByAttrItem([\"M·ª©c l∆∞∆°ng\", \"L∆∞∆°ng\"], null);\n  }\n  \n  // C·∫Øt b·ªè ph·∫ßn m√¥ t·∫£ ph√≠a sau\n  if (salary) {\n    salary = salary.split(/M·ª©c l∆∞∆°ng ph·ªï bi·∫øn|m·ª©c l∆∞∆°ng ph·ªï bi·∫øn|Th√¥ng tin th√™m|th√¥ng tin th√™m|M√¥ t·∫£|m√¥ t·∫£/i)[0].trim();\n    // L√†m s·∫°ch: \"ƒêang c·∫≠p nh·∫≠t\" => ƒë·ªÉ tr·ªëng\n    if (salary && (salary.toLowerCase().includes(\"ƒëang c·∫≠p nh·∫≠t\") || salary.toLowerCase().includes(\"c·∫≠p nh·∫≠t\"))) {\n      salary = \"\";\n    }\n  } else {\n    salary = \"\";\n  }\n  \n  // üü© Chuy·ªÉn ƒë·ªïi USD sang VNƒê v√† format theo Xtr-Ytr VNƒê/th√°ng\n  const USD_TO_VND = 24500;\n  if (salary && (salary.includes(\"$\") || salary.includes(\"USD\") || salary.includes(\"dollar\"))) {\n    const usdMatches = Array.from(salary.matchAll(/\\$?([\\d,]+(?:\\.[\\d]+)?)/g));\n    \n    if (usdMatches.length > 0) {\n      const amounts = usdMatches.map(match => {\n        const usdAmount = parseFloat(match[1].replace(/,/g, \"\"));\n        const vndAmount = Math.round(usdAmount * USD_TO_VND);\n        const trieu = (vndAmount / 1000000).toFixed(1);\n        return parseFloat(trieu).toString().replace(/\\.0$/, \"\") + \"tr\";\n      });\n      \n      if (amounts.length === 1) {\n        salary = amounts[0] + \" VNƒê/th√°ng\";\n      } else if (amounts.length === 2) {\n        salary = amounts[0] + \"-\" + amounts[1] + \" VNƒê/th√°ng\";\n      } else {\n        const nums = amounts.map(a => parseFloat(a.replace(/tr/, \"\")));\n        const min = Math.min(...nums);\n        const max = Math.max(...nums);\n        salary = min + \"tr-\" + max + \"tr VNƒê/th√°ng\";\n      }\n    }\n  }\n\n  // === L·∫•y c√°c th√¥ng tin t·ª´ .attr-item ===\n  let deadline = findByAttrItem([\"H·∫°n n·ªôp h·ªì s∆°\", \"H·∫°n tuy·ªÉn d·ª•ng\", \"H·∫øt h·∫°n\"], \"Kh√¥ng x√°c ƒë·ªãnh\");\n  let education = findByAttrItem([\"Tr√¨nh ƒë·ªô y√™u c·∫ßu\", \"Tr√¨nh ƒë·ªô\", \"H·ªçc v·∫•n\"], \"Kh√¥ng x√°c ƒë·ªãnh\");\n  let position = findByAttrItem([\"C·∫•p b·∫≠c\", \"V·ªã tr√≠\", \"Ch·ª©c v·ª•\"], \"Kh√¥ng x√°c ƒë·ªãnh\");\n  let experience = findByAttrItem([\"Kinh nghi·ªám y√™u c·∫ßu\", \"Kinh nghi·ªám\"], \"Kh√¥ng x√°c ƒë·ªãnh\");\n  let quantity = findByAttrItem([\"S·ªë l∆∞·ª£ng c·∫ßn tuy·ªÉn\", \"S·ªë l∆∞·ª£ng\"], \"Kh√¥ng x√°c ƒë·ªãnh\");\n  \n  // === L·∫•y ng√†y ƒëƒÉng t·ª´ \"C·∫≠p nh·∫≠t g·∫ßn nh·∫•t l√∫c\" ===\n  let postedDate = \"\";\n  try {\n    // T√¨m ph·∫ßn t·ª≠ ch·ª©a \"C·∫≠p nh·∫≠t g·∫ßn nh·∫•t l√∫c\" ho·∫∑c \"c·∫≠p nh·∫≠t\"\n    const allParagraphs = document.querySelectorAll('p, div, span');\n    for (const el of allParagraphs) {\n      const text = el.textContent || '';\n      if (text.includes('C·∫≠p nh·∫≠t g·∫ßn nh·∫•t l√∫c') || text.includes('c·∫≠p nh·∫≠t g·∫ßn nh·∫•t') || text.includes('C·∫≠p nh·∫≠t')) {\n        // Extract ng√†y t·ª´ text (format: 2025-10-04 18:25:02 ho·∫∑c t∆∞∆°ng t·ª±)\n        const dateMatch = text.match(/(\\d{4}[\\-\\/]\\d{1,2}[\\-\\/]\\d{1,2})/);\n        if (dateMatch) {\n          postedDate = dateMatch[1].replace(/\\//g, '-');\n          // ƒê·∫£m b·∫£o format YYYY-MM-DD\n          const parts = postedDate.split('-');\n          if (parts.length === 3) {\n            const year = parts[0];\n            const month = parts[1].padStart(2, '0');\n            const day = parts[2].padStart(2, '0');\n            postedDate = `${year}-${month}-${day}`;\n          }\n          break;\n        }\n      }\n    }\n    \n    // Fallback: t√¨m trong .content-group_content\n    if (!postedDate) {\n      const contentGroup = document.querySelector('.content-group_content, .content-group');\n      if (contentGroup) {\n        const text = contentGroup.textContent || '';\n        const dateMatch = text.match(/(\\d{4}[\\-\\/]\\d{1,2}[\\-\\/]\\d{1,2})/);\n        if (dateMatch) {\n          postedDate = dateMatch[1].replace(/\\//g, '-');\n          const parts = postedDate.split('-');\n          if (parts.length === 3) {\n            const year = parts[0];\n            const month = parts[1].padStart(2, '0');\n            const day = parts[2].padStart(2, '0');\n            postedDate = `${year}-${month}-${day}`;\n          }\n        }\n      }\n    }\n    \n    // N·∫øu v·∫´n kh√¥ng t√¨m th·∫•y, d√πng ng√†y hi·ªán t·∫°i\n    if (!postedDate) {\n      postedDate = new Date().toISOString().split(\"T\")[0];\n    }\n  } catch (e) {\n    postedDate = new Date().toISOString().split(\"T\")[0];\n  }\n\n  // === L√†m s·∫°ch d·ªØ li·ªáu ===\n  // L√†m s·∫°ch tr√¨nh ƒë·ªô\n  if (education && education.toLowerCase().includes(\"y√™u c·∫ßu\")) {\n    education = education.replace(/^y√™u c·∫ßu\\s*/i, \"\").trim();\n  }\n  if (education && (education.includes(\"Tr·∫Øc nghi·ªám\") || education.includes(\"MBTI\") || education.includes(\"MI\"))) {\n    education = \"\";\n  }\n  // \"Kh√¥ng x√°c ƒë·ªãnh\" => ƒë·ªÉ tr·ªëng\n  if (education && education.toLowerCase().includes(\"kh√¥ng x√°c ƒë·ªãnh\")) {\n    education = \"\";\n  }\n  // Chuy·ªÉn \"associate degree\" sang ti·∫øng Vi·ªát\n  if (education && education.toLowerCase().includes(\"associate degree\")) {\n    education = \"Cao ƒë·∫≥ng\";\n  }\n  \n  // L√†m s·∫°ch v·ªã tr√≠\n  if (position && (position.includes(\"Tr·∫Øc nghi·ªám\") || position.includes(\"MBTI\") || position.includes(\"MI\"))) {\n    position = \"Kh√¥ng x√°c ƒë·ªãnh\";\n  }\n  \n  // L√†m s·∫°ch kinh nghi·ªám\n  if (experience && experience.toLowerCase().includes(\"y√™u c·∫ßu\")) {\n    experience = experience.replace(/^y√™u c·∫ßu\\s*/i, \"\").trim();\n  }\n  if (experience && (experience.includes(\"OccupationalExperienceRequirements\") || experience.includes(\"l√† ƒëi·ªÉm c·ªông\") || experience.includes(\"C·∫≠p nh·∫≠t\"))) {\n    experience = \"\";\n  }\n  // \"Kh√¥ng x√°c ƒë·ªãnh\" => ƒë·ªÉ tr·ªëng\n  if (experience && experience.toLowerCase().includes(\"kh√¥ng x√°c ƒë·ªãnh\")) {\n    experience = \"\";\n  }\n  // N·∫øu ch·ªâ l√† s·ªë (l·ªói) => ƒë·ªÉ tr·ªëng\n  if (experience && /^\\s*\\d+\\s*$/.test(experience)) {\n    experience = \"\";\n  }\n  \n  // L√†m s·∫°ch s·ªë l∆∞·ª£ng\n  if (quantity && quantity.toLowerCase().includes(\"c·∫ßn tuy·ªÉn\")) {\n    quantity = quantity.replace(/^c·∫ßn tuy·ªÉn\\s*/i, \"\").trim();\n  }\n  if (quantity && (quantity.includes(\"ƒêang C·∫≠p Nh·∫≠t\") || quantity.includes(\"C·∫≠p nh·∫≠t\"))) {\n    quantity = \"\";\n  }\n  // \"Kh√¥ng x√°c ƒë·ªãnh\" => ƒë·ªÉ tr·ªëng\n  if (quantity && quantity.toLowerCase().includes(\"kh√¥ng x√°c ƒë·ªãnh\")) {\n    quantity = \"\";\n  }\n  \n  // L√†m s·∫°ch h·∫°n tuy·ªÉn d·ª•ng\n  if (deadline && (deadline.includes(\"ƒê·∫∑c ƒëi·ªÉm c√¥ng vi·ªác\") || deadline.includes(\"H√¨nh th·ª©c l√†m vi·ªác\") || deadline.includes(\"C·∫•p b·∫≠c\") || deadline.includes(\"Khu v·ª±c\") || deadline.includes(\"Xem th√™m\"))) {\n    const dateMatch = deadline.match(/(\\d{1,2}[\\/\\-]\\d{1,2}[\\/\\-]\\d{2,4})/);\n    deadline = dateMatch ? dateMatch[1] : \"Kh√¥ng x√°c ƒë·ªãnh\";\n  }\n  if (deadline && (deadline.includes(\"0961.469.398\") || deadline.includes(\"gi·ªù h√†nh ch√≠nh\"))) {\n    deadline = \"Kh√¥ng x√°c ƒë·ªãnh\";\n  }\n\n  return {\n    title, company, salary, education, position,\n    experience, quantity, postedDate, deadline,\n    major: Major, link: window.location.href\n  };\n}, Major);\n} catch (e) {\n  console.log(`‚ùå L·ªói khi thu th·∫≠p d·ªØ li·ªáu t·ª´ trang: ${e.message}`);\n  return [   {     json: {       skip: true,       Link: jobUrl || \"\",       message: \"URL l·ªói, b·ªè qua\"     }   } ]; // B·ªè qua link n√†y n·∫øu kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu\n}\n\n// üü© Ki·ªÉm tra job data h·ª£p l·ªá\nif (!job || !job.title) {\n  console.log(`‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá t·ª´ ${jobUrl}`);\n  return [   {     json: {       skip: true,       Link: jobUrl || \"\",       message: \"URL l·ªói, b·ªè qua\"     }   } ];\n}\n\n// üü© Tr·∫£ k·∫øt qu·∫£\ntry {\n  return [\n    {\n      json: {\n        \"Ti√™u ƒë·ªÅ c√¥ng vi·ªác\": job.title,\n        \"T√™n c√¥ng ty\": job.company,\n        \"Link\": job.link,\n        \"L∆∞∆°ng\": job.salary,\n        \"Tr√¨nh ƒë·ªô\": job.education,\n        \"V·ªã tr√≠\": job.position,\n        \"Kinh nghi·ªám\": job.experience,\n        \"S·ªë l∆∞·ª£ng\": job.quantity,\n        \"Ng√†y ƒëƒÉng\": job.postedDate,\n        \"H·∫°n tuy·ªÉn d·ª•ng\": job.deadline,\n        \"Chuy√™n ng√†nh\": job.major,\n      },\n    },\n  ];\n} catch (e) {\n  console.log(`‚ùå L·ªói khi format k·∫øt qu·∫£: ${e.message}`);\n  return [   {     json: {       skip: true,       Link: jobUrl || \"\",       message: \"URL l·ªói, b·ªè qua\"     }   } ];\n}\n\n} catch (error) {\n  // üü© B·ªè qua link l·ªói, log v√† ti·∫øp t·ª•c v·ªõi link kh√°c\n  console.log(`‚ùå L·ªói khi x·ª≠ l√Ω link ${$json.Url || 'unknown'}: ${error.message}`);\n  return [   {     json: {       skip: true,       Link: jobUrl || \"\",       message: \"URL l·ªói, b·ªè qua\"     }   } ]; // Tr·∫£ v·ªÅ empty ƒë·ªÉ b·ªè qua link n√†y\n}",
        "options": {}
      },
      "type": "n8n-nodes-puppeteer.puppeteer",
      "typeVersion": 1,
      "position": [
        6112,
        3200
      ],
      "id": "8e5382d4-21f9-4b0e-ad29-8e4c7f54c1ff",
      "name": "Truy c·∫≠p link l·∫•y th√¥ng tin",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9cb64851-9bfc-4b69-afdb-384b4d44bceb",
              "leftValue": "={{$json.skip}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "bc0d8486-b48d-4fb0-a2bf-c4f5ab15a225",
              "leftValue": "={{$json.skip}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6368,
        3248
      ],
      "id": "ff8e7142-b334-4e25-b7b7-48ebd7318465",
      "name": "If"
    }
  ],
  "pinData": {},
  "connections": {
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "L·∫∑p l·∫°i x·ª≠ l√Ω",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          },
          {
            "node": "X√≥a danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·∫•y ƒë·ªØ li·ªáu sheet list url c·∫ßn crawl": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Truy c·∫≠p v√†o link l·∫•y ra c√¥ng vi·ªác": {
      "main": [
        [
          {
            "node": "Th√™m ƒë·ªØ li·ªáu v√†o sheet list link tuy·ªÉn d·ª•ng",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Th√™m ƒë·ªØ li·ªáu v√†o sheet list link tuy·ªÉn d·ª•ng": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Th√™m ƒë·ªØ li·ªáu v√†o sheet danh s√°ch c√¥ng vi·ªác ƒë√£ crawl": {
      "main": [
        [
          {
            "node": "L·∫∑p l·∫°i x·ª≠ l√Ω",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·∫∑p l·∫°i x·ª≠ l√Ω": {
      "main": [
        [],
        [
          {
            "node": "Truy c·∫≠p link l·∫•y th√¥ng tin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "L·∫∑p l·∫°i x·ª≠ l√Ω",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Truy c·∫≠p v√†o link l·∫•y ra c√¥ng vi·ªác",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Truy c·∫≠p link l·∫•y th√¥ng tin": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "L·∫∑p l·∫°i x·ª≠ l√Ω",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Th√™m ƒë·ªØ li·ªáu v√†o sheet danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "79ddb17c-88dd-4990-8a91-e4c6538a679c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "be4bd479f567f96620153db3fcd673abbd059c76f34103f7251e61fb5e9ec621"
  },
  "id": "QNZIXG49gtXSI6sB",
  "tags": []
}