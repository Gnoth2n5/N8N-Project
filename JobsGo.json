{
  "name": "JobsGo",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -2592,
        112
      ],
      "id": "210d4288-fb65-4f57-bcde-6151d54cad13",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc",
          "mode": "list",
          "cachedResultName": "JobsGo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1293046103,
          "mode": "list",
          "cachedResultName": "danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc/edit#gid=1293046103"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2336,
        -240
      ],
      "id": "64182b9b-9357-4a66-b561-5eb444861a30",
      "name": "X√≥a danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc",
          "mode": "list",
          "cachedResultName": "JobsGo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "list url c·∫ßn crawl",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2336,
        112
      ],
      "id": "1a4b573c-aceb-4cc5-b3e0-ee07b0123fdc",
      "name": "L·∫•y ƒë·ªØ li·ªáu sheet list url c·∫ßn crawl",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "runCustomScript",
        "scriptCode": "// Helper\nconst sleep = (ms) => new Promise((res) => setTimeout(res, ms));\n\n// L·∫•y input\nlet baseUrl = $json.Url?.trim();\nif (!baseUrl) throw new Error(\"‚ùå Thi·∫øu 'Url' trong input!\");\n\nlet major = $json.Major || $json.major || \"\";\nconst MAX_PAGES = parseInt($json.MaxPages || $json.maxPages || \"5\");\nconst MAX_JOBS = parseInt($json.MaxJobs || $json.maxJobs || \"10\");\n\nlet allJobs = [];\nlet currentPage = 1;\n\n// T·ªëi ∆∞u request\nawait $page.setRequestInterception(true);\n$page.on(\"request\", (req) => {\n  const t = req.resourceType();\n  const u = req.url();\n  if ([\"image\", \"font\", \"media\"].includes(t) || /doubleclick|googletagmanager|analytics|facebook|adsystem|adservice|hotjar|mixpanel/i.test(u)) {\n    return req.abort();\n  }\n  req.continue();\n});\n\nwhile (true) {\n  // T·∫°o URL ph√¢n trang\n  let Url = baseUrl;\n  if (currentPage > 1) {\n    Url = baseUrl.includes(\"?\") ? `${baseUrl}&page=${currentPage}` : `${baseUrl}?page=${currentPage}`;\n  }\n\n  console.log(`üü¶ Trang ${currentPage}: ${Url}`);\n\n  // ƒêi ƒë·∫øn trang\n  await $page.goto(Url, { waitUntil: \"domcontentloaded\", timeout: 30000 });\n\n  // ƒê·ª£i job cards xu·∫•t hi·ªán - theo c·∫•u tr√∫c HTML trong ·∫£nh\n  try {\n    await $page.waitForSelector(\".col-grid .card.job-card, .job-card\", { timeout: 15000 });\n  } catch {\n    console.log(`‚ö†Ô∏è Kh√¥ng th·∫•y job ·ªü trang ${currentPage}`);\n    break;\n  }\n\n  // Cu·ªôn ƒë·ªÉ load h·∫øt\n  let lastCount = 0;\n  let noChangeCount = 0;\n  for (let i = 0; i < 10; i++) {\n    await $page.evaluate(() => window.scrollBy(0, document.body.scrollHeight));\n    await sleep(500);\n    const currentCount = await $page.$$eval(\".col-grid .card.job-card, .job-card\", (els) => els.length);\n    if (currentCount === lastCount) {\n      noChangeCount++;\n      if (noChangeCount >= 2) break;\n    } else {\n      noChangeCount = 0;\n    }\n    lastCount = currentCount;\n  }\n\n  // L·∫•y d·ªØ li·ªáu - target ƒë√∫ng HTML structure theo ·∫£nh\n  const jobsOnPage = await $page.evaluate(() => {\n    // T√¨m t·∫•t c·∫£ job cards: .col-grid ch·ª©a .card.job-card\n    const jobCards = document.querySelectorAll(\".col-grid .card.job-card, .card.job-card\");\n    const uniqueJobs = new Map();\n    \n    jobCards.forEach((card) => {\n      // T√¨m link: a[href*='/viec-lam/'] trong card\n      const linkEl = card.querySelector(\"a[href*='/viec-lam/']\");\n      if (!linkEl) return;\n      \n      const href = linkEl.getAttribute(\"href\") || linkEl.href || \"\";\n      if (!href || href.includes(\"#\")) return;\n      \n      // Chu·∫©n h√≥a URL\n      let fullUrl = href;\n      if (href.startsWith(\"/\")) {\n        fullUrl = \"https://jobsgo.vn\" + href;\n      }\n      \n      // L·∫•y ti√™u ƒë·ªÅ\n      const title = linkEl.textContent?.trim() || card.querySelector(\"h2, h3, .title, .job-title\")?.textContent?.trim() || \"\";\n      \n      // T√¨m l∆∞∆°ng ƒë∆°n gi·∫£n - kh√¥ng d√πng regex ph·ª©c t·∫°p\n      let salary = \"\";\n      const salaryEl = card.querySelector(\".salary, [class*='salary'], [class*='luong'], .wage, [class*='wage']\");\n      if (salaryEl) {\n        salary = salaryEl.textContent?.trim() || \"\";\n      }\n      \n      if (fullUrl && !uniqueJobs.has(fullUrl)) {\n        uniqueJobs.set(fullUrl, { Url: fullUrl, title: title || \"Kh√¥ng c√≥ ti√™u ƒë·ªÅ\", salary: salary });\n      }\n    });\n    \n    // L·ªçc job c√≥ l∆∞∆°ng h·ª£p l·ªá\n    const filteredJobs = Array.from(uniqueJobs.values()).filter(job => {\n      if (!job.salary || job.salary.trim() === \"\") {\n        return true; // Gi·ªØ l·∫°i n·∫øu kh√¥ng c√≥ l∆∞∆°ng ƒë·ªÉ check ·ªü loop 2\n      }\n      \n      const salaryLower = job.salary.toLowerCase().trim();\n      \n      // B·ªè qua c√°c t·ª´ kh√≥a kh√¥ng h·ª£p l·ªá\n      const skipKeywords = [\"ƒëang c·∫≠p nh·∫≠t\", \"c·∫≠p nh·∫≠t\", \"kh√¥ng x√°c ƒë·ªãnh\", \"th·ªèa thu·∫≠n\", \"flex\", \"flexible\"];\n      const shouldSkip = skipKeywords.some(keyword => salaryLower.includes(keyword));\n      \n      if (shouldSkip) {\n        return false;\n      }\n      \n      return true;\n    });\n    \n    return filteredJobs;\n  });\n\n  console.log(`‚úÖ Trang ${currentPage} c√≥ ${jobsOnPage.length} job`);\n  if (jobsOnPage.length === 0) break;\n\n  // G·∫Øn Source + Major\n  const mappedJobs = jobsOnPage.map((j) => ({\n    Source: baseUrl,\n    Url: j.Url,\n    link: j.Url,\n    title: j.title,\n    Major: major\n  }));\n\n  allJobs.push(...mappedJobs);\n\n  // Ki·ªÉm tra gi·ªõi h·∫°n\n  if (allJobs.length >= MAX_JOBS) {\n    console.log(`üõë ƒê√£ ƒë·∫°t gi·ªõi h·∫°n ${MAX_JOBS} job`);\n    allJobs = allJobs.slice(0, MAX_JOBS);\n    break;\n  }\n\n  if (currentPage >= MAX_PAGES) {\n    console.log(`üõë ƒê√£ ƒë·∫°t gi·ªõi h·∫°n ${MAX_PAGES} trang`);\n    break;\n  }\n\n  // Ki·ªÉm tra c√≤n trang kh√¥ng\n  const nextExists = await $page.evaluate(() => {\n    return !!(\n      document.querySelector(\".pagination .next:not(.disabled)\") ||\n      document.querySelector(\"a[href*='page=']:not([href*='page=1'])\") ||\n      document.querySelector(\".next-page, .pagination-next\")\n    );\n  });\n  \n  if (!nextExists) {\n    console.log(\"üõë H·∫øt trang\");\n    break;\n  }\n\n  currentPage++;\n  await sleep(800);\n}\n\nconsole.log(\"üéØ T·ªïng s·ªë vi·ªác l√†m:\", allJobs.length);\n\nreturn allJobs.map(job => ({ json: job }));",
        "options": {
          "args": [
            "--no-sandbox",
            "--disable-setuid-sandbox",
            "--disable-dev-shm-usage",
            "--disable-accelerated-2d-canvas",
            "--no-first-run",
            "--no-zygote",
            "--disable-gpu"
          ]
        }
      },
      "type": "n8n-nodes-puppeteer.puppeteer",
      "typeVersion": 1,
      "position": [
        -1728,
        208
      ],
      "id": "30a8ac7e-43fb-4878-92d3-3f6af0f4fe32",
      "name": "Truy c·∫≠p v√†o link l·∫•y ra c√¥ng vi·ªác",
      "alwaysOutputData": true,
      "executeOnce": false,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc",
          "mode": "list",
          "cachedResultName": "JobsGo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1293046103,
          "mode": "list",
          "cachedResultName": "danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit#gid=1293046103"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "L∆∞∆°ng": "={{ $json[\"L∆∞∆°ng\"] }}",
            "Tr√¨nh ƒë·ªô": "={{ $json[\"Tr√¨nh ƒë·ªô\"] }}",
            "S·ªë l∆∞·ª£ng": "={{ $json[\"S·ªë l∆∞·ª£ng\"] }}",
            "Kinh nghi·ªám": "={{ $json[\"Kinh nghi·ªám\"] }}",
            "Ng√†y ƒëƒÉng": "={{ $json[\"Ng√†y ƒëƒÉng\"] }}",
            "V·ªã tr√≠": "={{ $json[\"V·ªã tr√≠\"] }}",
            "H·∫°n tuy·ªÉn d·ª•ng": "={{ $json[\"H·∫°n tuy·ªÉn d·ª•ng\"] }}",
            "Chuy√™n ng√†nh": "={{ $json[\"Chuy√™n ng√†nh\"] }}",
            "Ti√™u ƒë·ªÅ c√¥ng vi·ªác": "={{ $json[\"Ti√™u ƒë·ªÅ c√¥ng vi·ªác\"] }}",
            "T√™n c√¥ng ty": "={{ $json[\"T√™n c√¥ng ty\"] }}",
            "Link": "={{ $json.Link }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Ti√™u ƒë·ªÅ c√¥ng vi·ªác",
              "displayName": "Ti√™u ƒë·ªÅ c√¥ng vi·ªác",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "T√™n c√¥ng ty",
              "displayName": "T√™n c√¥ng ty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Link",
              "displayName": "Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "L∆∞∆°ng",
              "displayName": "L∆∞∆°ng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Tr√¨nh ƒë·ªô",
              "displayName": "Tr√¨nh ƒë·ªô",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "V·ªã tr√≠",
              "displayName": "V·ªã tr√≠",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Kinh nghi·ªám",
              "displayName": "Kinh nghi·ªám",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "S·ªë l∆∞·ª£ng",
              "displayName": "S·ªë l∆∞·ª£ng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Ng√†y ƒëƒÉng",
              "displayName": "Ng√†y ƒëƒÉng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "H·∫°n tuy·ªÉn d·ª•ng",
              "displayName": "H·∫°n tuy·ªÉn d·ª•ng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Chuy√™n ng√†nh",
              "displayName": "Chuy√™n ng√†nh",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -176,
        -192
      ],
      "id": "58d72109-1981-4aa3-8150-e0bc7faa5a71",
      "name": "Th√™m ƒë·ªØ li·ªáu v√†o sheet danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
      "onError": "continueRegularOutput",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc",
          "mode": "list",
          "cachedResultName": "JobsGo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2020572363,
          "mode": "list",
          "cachedResultName": "list link tuy·ªÉn d·ª•ng ",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i077qGPoAgK1XLcbCLziqppsyFjwllMOpevn06Y1tXM/edit#gid=2020572363"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Url": "={{$json.link }}",
            "Source": "={{ $json.Source }}",
            "Major": "={{ $json.Major }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Source",
              "displayName": "Source",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Url",
              "displayName": "Url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Major",
              "displayName": "Major",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1280,
        208
      ],
      "id": "63f61b45-6493-4d14-9af7-57695463bc31",
      "name": "Th√™m ƒë·ªØ li·ªáu v√†o sheet list link tuy·ªÉn d·ª•ng",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -416,
        96
      ],
      "id": "a0e10a58-828d-47c2-be9a-76f46b2901ef",
      "name": "L·∫∑p l·∫°i x·ª≠ l√Ω",
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -2064,
        112
      ],
      "id": "f32bec6d-f491-422e-a386-3460432697d0",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc",
          "mode": "list",
          "cachedResultName": "JobsGo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2020572363,
          "mode": "list",
          "cachedResultName": "list link tuy·ªÉn d·ª•ng ",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1_Kp74rA_Ndx8-aEC7V5-mEzs2F61gRhjuy4wfa8cOnc/edit#gid=2020572363"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2336,
        -80
      ],
      "id": "e4485113-86d7-4e4c-b035-8908ce6de03a",
      "name": "X√≥a ƒë·ªØ li·ªáu c·ªßa sheet list link tuy·ªÉn d·ª•ng",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "runCustomScript",
        "scriptCode": "// üü© B·ªçc to√†n b·ªô trong try-catch ƒë·ªÉ b·ªè qua link l·ªói\ntry {\n// L·∫•y bi·∫øn t·ª´ input\nconst { Url, Major } = $json;\n\n// Chu·∫©n h√≥a URL\nlet jobUrl = (Url || \"\").trim();\nif (!jobUrl) {\n  console.log(\"‚ö†Ô∏è B·ªè qua: Kh√¥ng c√≥ URL h·ª£p l·ªá\");\n  return [];\n}\nif (jobUrl.startsWith(\"/\")) jobUrl = \"https://jobsgo.vn\" + jobUrl;\n\n// üü© Th√™m User-Agent ƒë·ªÉ tr√°nh b·ªã ch·∫∑n\nawait $page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36');\n\n// üü© Th√™m extra headers\nawait $page.setExtraHTTPHeaders({\n  'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n  'Accept-Language': 'vi-VN,vi;q=0.9,en-US;q=0.8,en;q=0.7',\n  'Accept-Encoding': 'gzip, deflate, br',\n  'Connection': 'keep-alive',\n  'Upgrade-Insecure-Requests': '1'\n});\n\n// T·ªëi ∆∞u request\nawait $page.setRequestInterception(true);\n$page.on(\"request\", (req) => {\n  const t = req.resourceType();\n  const u = req.url();\n  if ([\"image\", \"font\", \"media\"].includes(t) || /doubleclick|googletagmanager|analytics|facebook|adsystem|adservice|hotjar|mixpanel/i.test(u)) {\n    return req.abort();\n  }\n  req.continue();\n});\n\n// üü© Delay tr∆∞·ªõc khi truy c·∫≠p ƒë·ªÉ tr√°nh b·ªã ch·∫∑n\nawait new Promise(r => setTimeout(r, 1000 + Math.random() * 2000));\n\n// üü© Retry logic v·ªõi exponential backoff\nlet retries = 3;\nlet lastError = null;\nwhile (retries > 0) {\n  try {\n    // üü© Truy c·∫≠p trang v·ªõi timeout tƒÉng l√™n\n    await $page.goto(jobUrl, { \n      waitUntil: \"networkidle2\", \n      timeout: 60000 \n    });\n    break; // Th√†nh c√¥ng, tho√°t kh·ªèi retry loop\n  } catch (error) {\n    lastError = error;\n    retries--;\n    if (retries > 0) {\n      const delay = Math.pow(2, 3 - retries) * 2000; // 2s, 4s, 8s\n      console.log(`‚ö†Ô∏è L·ªói khi truy c·∫≠p ${jobUrl}, retry sau ${delay}ms... (c√≤n ${retries} l·∫ßn)`);\n      await new Promise(r => setTimeout(r, delay));\n    } else {\n      console.log(`‚ùå Kh√¥ng th·ªÉ truy c·∫≠p ${jobUrl} sau 3 l·∫ßn th·ª≠`);\n      // Th·ª≠ v·ªõi domcontentloaded n·∫øu networkidle2 fail\n      try {\n        await $page.goto(jobUrl, { waitUntil: \"domcontentloaded\", timeout: 30000 });\n      } catch (e) {\n        console.log(`‚ùå B·ªè qua link ${jobUrl} do l·ªói: ${lastError.message}`);\n        return []; // B·ªè qua link n√†y, ti·∫øp t·ª•c v·ªõi link kh√°c\n      }\n    }\n  }\n}\n\n// üü© Ch·ªù trang load ho√†n to√†n\nawait new Promise(r => setTimeout(r, 2000));\n\n// Ch·ªù ti√™u ƒë·ªÅ xu·∫•t hi·ªán - tƒÉng timeout\ntry {\n  await $page.waitForSelector(\"h1.job-title, body\", { timeout: 30000 });\n} catch (e) {\n  console.log(\"‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y ti√™u ƒë·ªÅ, ti·∫øp t·ª•c...\");\n  // Ki·ªÉm tra xem c√≥ b·ªã redirect ho·∫∑c block kh√¥ng\n  const currentUrl = $page.url();\n  if (currentUrl.includes('blocked') || currentUrl.includes('error') || currentUrl !== jobUrl) {\n    console.log(`‚ö†Ô∏è URL b·ªã thay ƒë·ªïi: ${currentUrl} (g·ªëc: ${jobUrl})`);\n  }\n}\n\n// Cu·ªôn ƒë·ªÉ t·∫£i h·∫øt n·ªôi dung\nawait $page.evaluate(async () => {\n  await new Promise(res => {\n    let y = 0;\n    const step = 1000;\n    const t = setInterval(() => {\n      window.scrollBy(0, step);\n      y += step;\n      if (y > document.body.scrollHeight + 1200) {\n        clearInterval(t);\n        res();\n      }\n    }, 80);\n  });\n});\nawait new Promise(r => setTimeout(r, 300));\n\n// Thu th·∫≠p d·ªØ li·ªáu - target ƒë√∫ng HTML structure c·ªßa jobsgo.vn\nconst job = await $page.evaluate((Major) => {\n  const get = (sel) => {\n    try {\n      const el = document.querySelector(sel);\n      return el?.textContent?.trim() || null;\n    } catch { return null; }\n  };\n  \n  // H√†m t√¨m th√¥ng tin trong .card-body theo label\n  const findByLabel = (labels) => {\n    const cols = document.querySelectorAll(\".card-body .col-6, .card-body .col-md-4\");\n    for (const col of cols) {\n      const labelEl = col.querySelector(\".text-muted\");\n      if (!labelEl) continue;\n      const labelText = labelEl.textContent?.trim() || \"\";\n      for (const label of labels) {\n        if (labelText.toLowerCase().includes(label.toLowerCase())) {\n          const strongEl = col.querySelector(\"strong\");\n          if (strongEl) {\n            return strongEl.textContent?.trim() || \"\";\n          }\n        }\n      }\n    }\n    return null;\n  };\n\n  // L·∫•y ti√™u ƒë·ªÅ\n  const title = get(\"h1.job-title\") || \"Kh√¥ng x√°c ƒë·ªãnh\";\n\n  // L·∫•y t√™n c√¥ng ty\n  let company = get(\".card-company h6.fw-semibold\") || get(\".company-logo + .flex-grow-1 h6\") || \"Kh√¥ng x√°c ƒë·ªãnh\";\n  company = company.trim();\n\n  // L·∫•y l∆∞∆°ng t·ª´ .job-info-list\n  let salary = null;\n  const jobInfoList = document.querySelector(\".job-info-list\");\n  if (jobInfoList) {\n    const salaryLi = Array.from(jobInfoList.querySelectorAll(\"li\")).find(li => {\n      return li.textContent?.includes(\"M·ª©c l∆∞∆°ng\") || li.textContent?.includes(\"l∆∞∆°ng\");\n    });\n    if (salaryLi) {\n      const strongEl = salaryLi.querySelector(\"strong\");\n      if (strongEl) {\n        salary = strongEl.textContent?.trim() || \"\";\n      }\n    }\n  }\n  if (!salary) salary = \"\";\n\n  // L·∫•y c√°c th√¥ng tin t·ª´ .card-body\n  const education = findByLabel([\"Y√™u c·∫ßu b·∫±ng c·∫•p\", \"b·∫±ng c·∫•p\", \"Tr√¨nh ƒë·ªô\"]) || \"\";\n  const position = findByLabel([\"V·ªã tr√≠/ch·ª©c v·ª•\", \"V·ªã tr√≠\", \"Ch·ª©c v·ª•\"]) || \"\";\n  const experience = findByLabel([\"Y√™u c·∫ßu kinh nghi·ªám\", \"Kinh nghi·ªám\"]) || \"\";\n  \n  // L·∫•y ng√†y ƒëƒÉng\n  const postedDate = findByLabel([\"Ng√†y ƒëƒÉng tuy·ªÉn\", \"Ng√†y ƒëƒÉng\"]) || \"\";\n  \n  // L·∫•y h·∫°n n·ªôp t·ª´ .job-info-list\n  let deadline = null;\n  if (jobInfoList) {\n    const deadlineLi = Array.from(jobInfoList.querySelectorAll(\"li\")).find(li => {\n      return li.textContent?.includes(\"H·∫°n n·ªôp\") || li.textContent?.includes(\"H·∫øt h·∫°n\");\n    });\n    if (deadlineLi) {\n      const strongEl = deadlineLi.querySelector(\"strong\");\n      if (strongEl) {\n        deadline = strongEl.textContent?.trim() || \"\";\n      }\n    }\n  }\n  if (!deadline) deadline = \"\";\n  \n  // S·ªë l∆∞·ª£ng - c√≥ th·ªÉ kh√¥ng c√≥ trong HTML\n  const quantity = \"\";\n\n  // L√†m s·∫°ch d·ªØ li·ªáu\n  const cleanText = (text) => {\n    if (!text) return \"\";\n    return text.trim();\n  };\n\n  return {\n    title: cleanText(title),\n    company: cleanText(company),\n    salary: cleanText(salary),\n    education: cleanText(education),\n    position: cleanText(position),\n    experience: cleanText(experience),\n    quantity: cleanText(quantity),\n    postedDate: cleanText(postedDate),\n    deadline: cleanText(deadline),\n    major: Major || \"\",\n    link: window.location.href\n  };\n}, Major);\n\n// Tr·∫£ k·∫øt qu·∫£\nreturn [\n  {\n    json: {\n      \"Ti√™u ƒë·ªÅ c√¥ng vi·ªác\": job.title,\n      \"T√™n c√¥ng ty\": job.company,\n      \"Link\": job.link,\n      \"L∆∞∆°ng\": job.salary,\n      \"Tr√¨nh ƒë·ªô\": job.education,\n      \"V·ªã tr√≠\": job.position,\n      \"Kinh nghi·ªám\": job.experience,\n      \"S·ªë l∆∞·ª£ng\": job.quantity,\n      \"Ng√†y ƒëƒÉng\": job.postedDate,\n      \"H·∫°n tuy·ªÉn d·ª•ng\": job.deadline,\n      \"Chuy√™n ng√†nh\": job.major,\n    },\n  },\n];\n\n} catch (error) {\n  // üü© B·ªè qua link l·ªói, log v√† ti·∫øp t·ª•c v·ªõi link kh√°c\n  console.log(`‚ùå L·ªói khi x·ª≠ l√Ω link ${$json.Url || 'unknown'}: ${error.message}`);\n  return []; // Tr·∫£ v·ªÅ empty ƒë·ªÉ b·ªè qua link n√†y\n}",
        "options": {
          "args": [
            "--no-sandbox",
            "--disable-setuid-sandbox",
            "--disable-dev-shm-usage",
            "--disable-accelerated-2d-canvas",
            "--no-first-run",
            "--no-zygote",
            "--disable-gpu"
          ]
        }
      },
      "type": "n8n-nodes-puppeteer.puppeteer",
      "typeVersion": 1,
      "position": [
        -848,
        -192
      ],
      "id": "1cf239b2-bbd5-4211-b5e7-897ab07e2173",
      "name": "Truy c·∫≠p link l·∫•y th√¥ng tin",
      "onError": "continueRegularOutput"
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "L·∫•y ƒë·ªØ li·ªáu sheet list url c·∫ßn crawl",
            "type": "main",
            "index": 0
          },
          {
            "node": "X√≥a ƒë·ªØ li·ªáu c·ªßa sheet list link tuy·ªÉn d·ª•ng",
            "type": "main",
            "index": 0
          },
          {
            "node": "X√≥a danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·∫•y ƒë·ªØ li·ªáu sheet list url c·∫ßn crawl": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Truy c·∫≠p v√†o link l·∫•y ra c√¥ng vi·ªác": {
      "main": [
        [
          {
            "node": "Th√™m ƒë·ªØ li·ªáu v√†o sheet list link tuy·ªÉn d·ª•ng",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Th√™m ƒë·ªØ li·ªáu v√†o sheet list link tuy·ªÉn d·ª•ng": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Th√™m ƒë·ªØ li·ªáu v√†o sheet danh s√°ch c√¥ng vi·ªác ƒë√£ crawl": {
      "main": [
        [
          {
            "node": "L·∫∑p l·∫°i x·ª≠ l√Ω",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·∫∑p l·∫°i x·ª≠ l√Ω": {
      "main": [
        [],
        [
          {
            "node": "Truy c·∫≠p link l·∫•y th√¥ng tin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "L·∫∑p l·∫°i x·ª≠ l√Ω",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Truy c·∫≠p v√†o link l·∫•y ra c√¥ng vi·ªác",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Truy c·∫≠p link l·∫•y th√¥ng tin": {
      "main": [
        [
          {
            "node": "Th√™m ƒë·ªØ li·ªáu v√†o sheet danh s√°ch c√¥ng vi·ªác ƒë√£ crawl",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "c0d9abc4-59e5-4be0-8d13-27aee719f929",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "be4bd479f567f96620153db3fcd673abbd059c76f34103f7251e61fb5e9ec621"
  },
  "id": "YXE0QQUhm8K4SQdx",
  "tags": []
}