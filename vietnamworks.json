{
  "name": "vietnamworks",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -240,
        272
      ],
      "id": "7e06c30e-1539-4968-b359-493630708474",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ",
          "mode": "list",
          "cachedResultName": "VietnamWork",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 690120639,
          "mode": "list",
          "cachedResultName": "JobDetail",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ/edit#gid=690120639"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        16,
        -80
      ],
      "id": "efdd06e4-a06d-4c44-8111-78887d081acc",
      "name": "XÃ³a danh sÃ¡ch cÃ´ng viá»‡c Ä‘Ã£ crawl",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ",
          "mode": "list",
          "cachedResultName": "VietnamWork",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 210296615,
          "mode": "list",
          "cachedResultName": "JobUrl",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ/edit#gid=210296615"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        16,
        80
      ],
      "id": "b78b5246-ddab-4e1d-bc4f-bbcb537ddaf9",
      "name": "XÃ³a Ä‘á»¯ liá»‡u cá»§a sheet list url cáº§n crawl",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ",
          "mode": "list",
          "cachedResultName": "VietnamWork",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "SearchUrl",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ/edit#gid=0"
        },
        "combineFilters": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        16,
        272
      ],
      "id": "a61e67ef-c719-4873-99eb-4404bac61af3",
      "name": "Láº¥y Ä‘á»¯ liá»‡u sheet list url cáº§n crawl",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "runCustomScript",
        "scriptCode": "// --- Helper ---\nconst sleep = (ms) => new Promise((res) => setTimeout(res, ms));\n\n// --- Láº¤Y LINK Äáº¦U VÃ€O ---\nlet baseUrl = $json.Url?.trim();\nif (!baseUrl) throw new Error(\"âŒ Thiáº¿u 'Url' trong input!\");\n\nlet major = $json.Major || $json.major || \"\";\n\n// ğŸŸ© GIá»šI Háº N Äá»‚ TRÃNH CRAWL QUÃ NHIá»€U\nconst MAX_PAGES = parseInt($json.MaxPages || $json.maxPages || \"5\"); // Máº·c Ä‘á»‹nh 5 trang\nconst MAX_JOBS = parseInt($json.MaxJobs || $json.maxJobs || \"200\"); // Máº·c Ä‘á»‹nh 200 job\n\nlet allJobs = [];\nlet currentPage = 1;\n\n// ğŸŸ© Tá»‘i Æ°u: Cháº·n request khÃ´ng cáº§n thiáº¿t Ä‘á»ƒ tÄƒng tá»‘c\nawait $page.setRequestInterception(true);\n$page.on(\"request\", (req) => {\n  const t = req.resourceType();\n  const u = req.url();\n  if (\n    [\"image\", \"font\", \"media\"].includes(t) ||\n    /doubleclick|googletagmanager|analytics|facebook|adsystem|adservice|hotjar|mixpanel/i.test(u)\n  ) return req.abort();\n  req.continue();\n});\n\nwhile (true) {\n  // --- Táº O LINK PHÃ‚N TRANG ---\n  let Url = baseUrl;\n  if (currentPage > 1) {\n    Url = baseUrl.includes(\"?\")\n      ? `${baseUrl}&page=${currentPage}`\n      : `${baseUrl}?page=${currentPage}`;\n  }\n\n  console.log(`ğŸŸ¦ Äang xá»­ lÃ½ trang ${currentPage}: ${Url}`);\n\n  // --- ÄI Äáº¾N TRANG ---\n  await $page.goto(Url, { waitUntil: \"domcontentloaded\", timeout: 30000 });\n\n  // --- Äá»¢I JOB HIá»†N RA ---\n  try {\n    await $page.waitForSelector(\".view_job_item h2 a, .search_list.view_job_item h2 a\", { timeout: 15000 });\n  } catch {\n    console.log(`âš ï¸ KhÃ´ng tháº¥y job á»Ÿ trang ${currentPage}, dá»«ng láº¡i.`);\n    break;\n  }\n\n  // --- CUá»˜N Äá»‚ LOAD Háº¾T JOB (Tá»I Æ¯U) ---\n  let lastCount = 0;\n  let noChangeCount = 0;\n  for (let i = 0; i < 10; i++) {\n    await $page.evaluate(() => window.scrollBy(0, document.body.scrollHeight));\n    await sleep(500);\n    const currentCount = await $page.$$eval(\n      \".view_job_item, .search_list.view_job_item\",\n      (els) => els.length\n    );\n    if (currentCount === lastCount) {\n      noChangeCount++;\n      if (noChangeCount >= 2) break;\n    } else {\n      noChangeCount = 0;\n    }\n    lastCount = currentCount;\n  }\n\n  // --- Láº¤Y Dá»® LIá»†U ---\n  const jobsOnPage = await $page.evaluate(() => {\n    const jobItems = document.querySelectorAll(\".view_job_item, .search_list.view_job_item\");\n    return Array.from(jobItems).map((item) => {\n      const titleEl = item.querySelector(\"h2 a[href]\");\n      const link = titleEl ? titleEl.href : \"\";\n      const title = titleEl ? titleEl.textContent.trim() : \"\";\n      return {\n        Url: link.startsWith(\"/\") ? \"https://www.vietnamworks.com\" + link : link,\n        title: title\n      };\n    });\n  });\n\n  console.log(`âœ… Trang ${currentPage} cÃ³ ${jobsOnPage.length} job`);\n  if (jobsOnPage.length === 0) break;\n\n  // --- Gáº®N SOURCE + MAJOR ---\n  const mappedJobs = jobsOnPage.map((j) => ({\n    Source: baseUrl,\n    Url: j.Url,\n    link: j.Url,\n    title: j.title,\n    Major: major\n  }));\n\n  allJobs.push(...mappedJobs);\n\n  // ğŸŸ© KIá»‚M TRA GIá»šI Háº N Sá» LÆ¯á»¢NG JOB\n  if (allJobs.length >= MAX_JOBS) {\n    console.log(`ğŸ›‘ ÄÃ£ Ä‘áº¡t giá»›i háº¡n ${MAX_JOBS} job, dá»«ng láº¡i!`);\n    allJobs = allJobs.slice(0, MAX_JOBS); // Cáº¯t bá»›t náº¿u vÆ°á»£t quÃ¡\n    break;\n  }\n\n  // ğŸŸ© KIá»‚M TRA GIá»šI Háº N Sá» TRANG\n  if (currentPage >= MAX_PAGES) {\n    console.log(`ğŸ›‘ ÄÃ£ Ä‘áº¡t giá»›i háº¡n ${MAX_PAGES} trang, dá»«ng láº¡i!`);\n    break;\n  }\n\n  // --- KIá»‚M TRA XEM CÃ’N TRANG KHÃ”NG ---\n  const nextExists = await $page.$(\"ul.pagination li.active + li button\");\n  if (!nextExists) {\n    console.log(\"ğŸ›‘ Háº¿t trang, dá»«ng!\");\n    break;\n  }\n\n  currentPage++;\n  await sleep(800);\n}\n\nconsole.log(\"ğŸ¯ Tá»•ng sá»‘ viá»‡c lÃ m:\", allJobs.length);\n\n// Tráº£ vá» dáº¡ng array cho n8n\nreturn allJobs.map(job => ({ json: job }));",
        "options": {
          "args": [
            "--no-sandbox",
            "--disable-setuid-sandbox",
            "--disable-dev-shm-usage",
            "--disable-accelerated-2d-canvas",
            "--no-first-run",
            "--no-zygote",
            "--disable-gpu"
          ]
        }
      },
      "type": "n8n-nodes-puppeteer.puppeteer",
      "typeVersion": 1,
      "position": [
        576,
        -128
      ],
      "id": "6b160cc0-5f51-4640-a30f-f645f4573d87",
      "name": "Truy cáº­p vÃ o link láº¥y ra cÃ´ng viá»‡c",
      "alwaysOutputData": true,
      "executeOnce": false,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ",
          "mode": "list",
          "cachedResultName": "VietnamWork",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 690120639,
          "mode": "list",
          "cachedResultName": "JobDetail",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ/edit#gid=690120639"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "TiÃªu Ä‘á»": "={{ $json[\"TiÃªu Ä‘á» cÃ´ng viá»‡c\"] }}",
            "Url": "={{ $json.Link }}",
            "LÆ°Æ¡ng": "={{ $json[\"LÆ°Æ¡ng\"] }}",
            "TrÃ¬nh Ä‘á»™": "={{ $json[\"TrÃ¬nh Ä‘á»™\"] }}",
            "Sá»‘ lÆ°á»£ng": "={{ $json[\"Sá»‘ lÆ°á»£ng\"] }}",
            "Kinh nghiá»‡m": "={{ $json[\"Kinh nghiá»‡m\"] }}",
            "NgÃ y Ä‘Äƒng": "={{ $json[\"NgÃ y Ä‘Äƒng\"] }}",
            "Vá»‹ trÃ­": "={{ $json[\"Vá»‹ trÃ­\"] }}",
            "Háº¡n tuyá»ƒn dá»¥ng": "={{ $json[\"Háº¡n tuyá»ƒn dá»¥ng\"] }}",
            "ChuyÃªn ngÃ nh": "={{ $json[\"ChuyÃªn ngÃ nh\"] }}",
            "CÃ´ng ty": "={{ $json[\"TÃªn cÃ´ng ty\"] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "TiÃªu Ä‘á»",
              "displayName": "TiÃªu Ä‘á»",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CÃ´ng ty",
              "displayName": "CÃ´ng ty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Url",
              "displayName": "Url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LÆ°Æ¡ng",
              "displayName": "LÆ°Æ¡ng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TrÃ¬nh Ä‘á»™",
              "displayName": "TrÃ¬nh Ä‘á»™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Sá»‘ lÆ°á»£ng",
              "displayName": "Sá»‘ lÆ°á»£ng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Kinh nghiá»‡m",
              "displayName": "Kinh nghiá»‡m",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "NgÃ y Ä‘Äƒng",
              "displayName": "NgÃ y Ä‘Äƒng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vá»‹ trÃ­",
              "displayName": "Vá»‹ trÃ­",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Háº¡n tuyá»ƒn dá»¥ng",
              "displayName": "Háº¡n tuyá»ƒn dá»¥ng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ChuyÃªn ngÃ nh",
              "displayName": "ChuyÃªn ngÃ nh",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2160,
        -32
      ],
      "id": "0d7b5e23-14aa-4f06-bf34-cb291a156afc",
      "name": "ThÃªm Ä‘á»¯ liá»‡u vÃ o sheet danh sÃ¡ch cÃ´ng viá»‡c Ä‘Ã£ crawl",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ",
          "mode": "list",
          "cachedResultName": "VietnamWork",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 210296615,
          "mode": "list",
          "cachedResultName": "JobUrl",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19FpVmUsyrf7Xjo-kFk4MjrXgRb3ibfumJNfwUz0yUBQ/edit#gid=210296615"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Url": "={{$json.link }}",
            "Source": "={{ $json.Url }}",
            "Major": "={{ $json.Major }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Source",
              "displayName": "Source",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Url",
              "displayName": "Url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Major",
              "displayName": "Major",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "body",
              "displayName": "body",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "headers",
              "displayName": "headers",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "statusCode",
              "displayName": "statusCode",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1072,
        368
      ],
      "id": "f468a0cc-095b-435d-bb7d-290e400156e1",
      "name": "ThÃªm Ä‘á»¯ liá»‡u vÃ o sheet list link tuyá»ƒn dá»¥ng",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "KWvXTlQdV9eqObfN",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1920,
        256
      ],
      "id": "e4f1665d-4087-4b1f-97d2-875236dfe6b1",
      "name": "Láº·p láº¡i xá»­ lÃ½",
      "retryOnFail": true,
      "waitBetweenTries": 2000
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        288,
        272
      ],
      "id": "e53784dd-a8a4-4936-a86f-5099173c46b6",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "operation": "runCustomScript",
        "scriptCode": "// ğŸŸ© Bá»c toÃ n bá»™ trong try-catch Ä‘á»ƒ bá» qua link lá»—i\ntry {\n// ğŸŸ© Láº¥y biáº¿n tá»« input JSON\nconst { Url: inputUrl, Major } = $json;\n\n// ğŸŸ© Chuáº©n hÃ³a URL\nlet jobUrl = (inputUrl || \"\").trim();\nif (!jobUrl) {\n  console.log(\"âš ï¸ Bá» qua: KhÃ´ng cÃ³ URL há»£p lá»‡\");\n  return [];\n}\nif (jobUrl.startsWith(\"/\")) jobUrl = \"https://www.vietnamworks.com\" + jobUrl;\n\n// ğŸŸ© ThÃªm User-Agent Ä‘á»ƒ trÃ¡nh bá»‹ cháº·n\nawait $page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36');\n\n// ğŸŸ© ThÃªm extra headers\nawait $page.setExtraHTTPHeaders({\n  'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n  'Accept-Language': 'vi-VN,vi;q=0.9,en-US;q=0.8,en;q=0.7',\n  'Accept-Encoding': 'gzip, deflate, br',\n  'Connection': 'keep-alive',\n  'Upgrade-Insecure-Requests': '1'\n});\n\n// ğŸŸ© Giáº£m táº£i request rÃ¡c (Tá»I Æ¯U)\nawait $page.setRequestInterception(true);\n$page.on(\"request\", (req) => {\n  const t = req.resourceType();\n  const u = req.url();\n  if (\n    [\"image\", \"font\", \"media\"].includes(t) ||\n    /doubleclick|googletagmanager|analytics|facebook|adsystem|adservice|hotjar|mixpanel/i.test(u)\n  ) return req.abort();\n  req.continue();\n});\n\n// ğŸŸ© Delay trÆ°á»›c khi truy cáº­p Ä‘á»ƒ trÃ¡nh bá»‹ cháº·n\nawait new Promise(r => setTimeout(r, 1000 + Math.random() * 2000));\n\n// ğŸŸ© Retry logic vá»›i exponential backoff\nlet retries = 3;\nlet lastError = null;\nwhile (retries > 0) {\n  try {\n    // ğŸŸ© Truy cáº­p trang vá»›i timeout tÄƒng lÃªn\n    await $page.goto(jobUrl, { \n      waitUntil: \"networkidle2\", \n      timeout: 60000 \n    });\n    break; // ThÃ nh cÃ´ng, thoÃ¡t khá»i retry loop\n  } catch (error) {\n    lastError = error;\n    retries--;\n    if (retries > 0) {\n      const delay = Math.pow(2, 3 - retries) * 2000; // 2s, 4s, 8s\n      console.log(`âš ï¸ Lá»—i khi truy cáº­p ${jobUrl}, retry sau ${delay}ms... (cÃ²n ${retries} láº§n)`);\n      await new Promise(r => setTimeout(r, delay));\n    } else {\n      console.log(`âŒ KhÃ´ng thá»ƒ truy cáº­p ${jobUrl} sau 3 láº§n thá»­`);\n      // Thá»­ vá»›i domcontentloaded náº¿u networkidle2 fail\n      try {\n        await $page.goto(jobUrl, { waitUntil: \"domcontentloaded\", timeout: 30000 });\n      } catch (e) {\n        console.log(`âŒ Bá» qua link ${jobUrl} do lá»—i: ${lastError.message}`);\n        return []; // Bá» qua link nÃ y, tiáº¿p tá»¥c vá»›i link khÃ¡c\n      }\n    }\n  }\n}\n\n// ğŸŸ© Chá» trang load hoÃ n toÃ n\nawait new Promise(r => setTimeout(r, 2000));\n\n// ğŸŸ© Chá» tiÃªu Ä‘á» xuáº¥t hiá»‡n - tÄƒng timeout\ntry {\n  await $page.waitForSelector(\"h1[name='title']\", { timeout: 30000 });\n} catch (e) {\n  console.log(\"âš ï¸ KhÃ´ng tÃ¬m tháº¥y tiÃªu Ä‘á», tiáº¿p tá»¥c...\");\n  // Kiá»ƒm tra xem cÃ³ bá»‹ redirect hoáº·c block khÃ´ng\n  const currentUrl = $page.url();\n  if (currentUrl.includes('blocked') || currentUrl.includes('error') || currentUrl !== jobUrl) {\n    console.log(`âš ï¸ URL bá»‹ thay Ä‘á»•i: ${currentUrl} (gá»‘c: ${jobUrl})`);\n  }\n}\n\n// ğŸŸ© Má»Ÿ rá»™ng cÃ¡c pháº§n Xem thÃªm (Tá»I Æ¯U: giáº£m sá»‘ láº§n láº·p vÃ  sleep)\nfor (let i = 0; i < 5; i++) { // Giáº£m tá»« 8 xuá»‘ng 5\n  const clicked = await $page.evaluate(() => {\n    let c = 0;\n    document.querySelectorAll('button[aria-label=\"Xem thÃªm\"]').forEach(btn => {\n      if (btn.offsetParent) { btn.click(); c++; }\n    });\n    return c;\n  });\n  if (!clicked) break;\n  await new Promise(r => setTimeout(r, 300)); // Giáº£m tá»« 500ms xuá»‘ng 300ms\n}\n\n// ğŸŸ© Cuá»™n Ä‘á»ƒ táº£i háº¿t ná»™i dung (Tá»I Æ¯U: scroll nhanh hÆ¡n, Ã­t sleep)\nawait $page.evaluate(async () => {\n  await new Promise(res => {\n    let y = 0;\n    const step = 1000; // TÄƒng step lÃªn 1000px Ä‘á»ƒ scroll nhanh hÆ¡n\n    const t = setInterval(() => {\n      window.scrollBy(0, step);\n      y += step;\n      if (y > document.body.scrollHeight + 1200) {\n        clearInterval(t);\n        res();\n      }\n    }, 80); // Giáº£m interval tá»« 100ms xuá»‘ng 80ms\n  });\n});\nawait new Promise(r => setTimeout(r, 300)); // Giáº£m tá»« 500ms xuá»‘ng 300ms\n\n// ğŸŸ© Thu tháº­p dá»¯ liá»‡u chÃ­nh\nconst job = await $page.evaluate((Major) => {\n  const get = (sel) => document.querySelector(sel)?.textContent.trim() || null;\n\n  // === Láº¥y thÃ´ng tin chÃ­nh ===\n  const title = get(\"h1[name='title']\") || \"KhÃ´ng xÃ¡c Ä‘á»‹nh\";\n  const company = get(\"a[name='label']\") || \"KhÃ´ng xÃ¡c Ä‘á»‹nh\";\n\n  // --- LÆ°Æ¡ng & Háº¡n (Sá»¬A: chá»‰ láº¥y pháº§n lÆ°Æ¡ng, cáº¯t bá» pháº§n mÃ´ táº£, chuyá»ƒn USD sang VNÄ) ---\n  let salaryRaw = get('div[id=\"vnwLayout__col\"] span[name=\"label\"]') || \"Thá»a thuáº­n\";\n  // Cáº¯t bá» pháº§n mÃ´ táº£ phÃ­a sau (náº¿u cÃ³)\n  let salary = salaryRaw.split(/Má»©c lÆ°Æ¡ng phá»• biáº¿n|má»©c lÆ°Æ¡ng phá»• biáº¿n|ThÃ´ng tin thÃªm|thÃ´ng tin thÃªm/i)[0].trim() || \"Thá»a thuáº­n\";\n  \n  // ğŸŸ© Format lÆ°Æ¡ng: \"thÆ°Æ¡ng lÆ°á»£ng\" => Ä‘á»ƒ trá»‘ng\n  if (salary && salary.toLowerCase().includes(\"thÆ°Æ¡ng lÆ°á»£ng\")) {\n    salary = \"\";\n  }\n  \n  // ğŸŸ© Chuyá»ƒn Ä‘á»•i USD sang VNÄ vÃ  format theo Xtr-Ytr VNÄ/thÃ¡ng\n  const USD_TO_VND = 24500; // Tá»· giÃ¡ máº·c Ä‘á»‹nh\n  if (salary && (salary.includes(\"$\") || salary.includes(\"USD\") || salary.includes(\"dollar\"))) {\n    // TÃ¬m táº¥t cáº£ sá»‘ tiá»n USD (há»— trá»£ khoáº£ng lÆ°Æ¡ng nhÆ° $1,000 - $2,000)\n    const usdMatches = Array.from(salary.matchAll(/\\$?([\\d,]+(?:\\.[\\d]+)?)/g));\n    \n    if (usdMatches.length > 0) {\n      const amounts = usdMatches.map(match => {\n        const usdAmount = parseFloat(match[1].replace(/,/g, \"\"));\n        const vndAmount = Math.round(usdAmount * USD_TO_VND);\n        // Chuyá»ƒn sang Ä‘Æ¡n vá»‹ tr (triá»‡u Ä‘á»“ng)\n        const trieu = (vndAmount / 1000000).toFixed(1);\n        // Bá» sá»‘ 0 thá»«a (10.0 -> 10)\n        return parseFloat(trieu).toString().replace(/\\.0$/, \"\") + \"tr\";\n      });\n      \n      // Format theo Xtr-Ytr VNÄ/thÃ¡ng hoáº·c Xtr VNÄ/thÃ¡ng\n      if (amounts.length === 1) {\n        salary = amounts[0] + \" VNÄ/thÃ¡ng\";\n      } else if (amounts.length === 2) {\n        salary = amounts[0] + \"-\" + amounts[1] + \" VNÄ/thÃ¡ng\";\n      } else {\n        // Náº¿u cÃ³ nhiá»u hÆ¡n 2 sá»‘, láº¥y min vÃ  max\n        const nums = amounts.map(a => parseFloat(a.replace(/tr/, \"\")));\n        const min = Math.min(...nums);\n        const max = Math.max(...nums);\n        salary = min + \"tr-\" + max + \"tr VNÄ/thÃ¡ng\";\n      }\n    }\n  }\n  const deadline =\n    get('span[name=\"paragraph\"][color=\"#000\"]') || \"KhÃ´ng xÃ¡c Ä‘á»‹nh\";\n\n  // --- CÃ¡c má»¥c thÃ´ng tin ---\n  let position = \"KhÃ´ng xÃ¡c Ä‘á»‹nh\",\n      education = \"KhÃ´ng xÃ¡c Ä‘á»‹nh\",\n      experience = \"KhÃ´ng xÃ¡c Ä‘á»‹nh\",\n      quantity = \"KhÃ´ng xÃ¡c Ä‘á»‹nh\",\n      postedDate = new Date().toISOString().split(\"T\")[0];\n\n  document.querySelectorAll(\"div.JtIju\").forEach((block) => {\n    const label = block.querySelector(\"label.dfyRSX\")?.innerText.toLowerCase() || \"\";\n    const val = block.querySelector(\"p.cLLblL, span.bPjxRh, li, a\")?.innerText.trim() || \"\";\n\n    if (label.includes(\"há»c váº¥n\") || label.includes(\"trÃ¬nh Ä‘á»™\")) education = val;\n    if (label.includes(\"cáº¥p báº­c\")) position = val;\n    if (label.includes(\"kinh nghiá»‡m\")) experience = val;\n    if (label.includes(\"sá»‘ lÆ°á»£ng\")) quantity = val;\n    if (label.includes(\"Ä‘Äƒng\") || label.includes(\"ngÃ y táº¡o\")) postedDate = val || postedDate;\n  });\n\n  // ğŸŸ© Format trÃ¬nh Ä‘á»™: \"KhÃ´ng giá»›i háº¡n\" => Ä‘á»ƒ trá»‘ng\n  if (education && education.toLowerCase().includes(\"khÃ´ng giá»›i háº¡n\")) {\n    education = \"\";\n  }\n\n  // ğŸŸ© Format sá»‘ lÆ°á»£ng: \"KhÃ´ng xÃ¡c Ä‘á»‹nh\", \"KhÃ´ng hiá»ƒn thá»‹\" => \"1\"\n  if (quantity && (quantity.toLowerCase().includes(\"khÃ´ng xÃ¡c Ä‘á»‹nh\") || quantity.toLowerCase().includes(\"khÃ´ng hiá»ƒn thá»‹\"))) {\n    quantity = \"1\";\n  }\n\n  return {\n    title, company, salary, education, position,\n    experience, quantity, postedDate, deadline,\n    major: Major, link: window.location.href\n  };\n}, Major);\n\n// ğŸŸ© Tráº£ káº¿t quáº£\nreturn [\n  {\n    json: {\n      \"TiÃªu Ä‘á» cÃ´ng viá»‡c\": job.title,\n      \"TÃªn cÃ´ng ty\": job.company,\n      \"Link\": job.link,\n      \"LÆ°Æ¡ng\": job.salary,\n      \"TrÃ¬nh Ä‘á»™\": job.education,\n      \"Vá»‹ trÃ­\": job.position,\n      \"Kinh nghiá»‡m\": job.experience,\n      \"Sá»‘ lÆ°á»£ng\": job.quantity,\n      \"NgÃ y Ä‘Äƒng\": job.postedDate,\n      \"Háº¡n tuyá»ƒn dá»¥ng\": job.deadline,\n      \"ChuyÃªn ngÃ nh\": job.major,\n    },\n  },\n];\n\n} catch (error) {\n  // ğŸŸ© Bá» qua link lá»—i, log vÃ  tiáº¿p tá»¥c vá»›i link khÃ¡c\n  console.log(`âŒ Lá»—i khi xá»­ lÃ½ link ${$json.Url || $json.inputUrl || 'unknown'}: ${error.message}`);\n  return []; // Tráº£ vá» empty Ä‘á»ƒ bá» qua link nÃ y\n}",
        "options": {
          "args": [
            "--no-sandbox",
            "--disable-setuid-sandbox",
            "--disable-dev-shm-usage",
            "--disable-accelerated-2d-canvas",
            "--no-first-run",
            "--no-zygote",
            "--disable-gpu"
          ]
        }
      },
      "type": "n8n-nodes-puppeteer.puppeteer",
      "typeVersion": 1,
      "position": [
        1488,
        -32
      ],
      "id": "68632c41-9c98-495d-a07a-38643ff91c73",
      "name": "Puppeteer"
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Láº¥y Ä‘á»¯ liá»‡u sheet list url cáº§n crawl",
            "type": "main",
            "index": 0
          },
          {
            "node": "XÃ³a Ä‘á»¯ liá»‡u cá»§a sheet list url cáº§n crawl",
            "type": "main",
            "index": 0
          },
          {
            "node": "XÃ³a danh sÃ¡ch cÃ´ng viá»‡c Ä‘Ã£ crawl",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Láº¥y Ä‘á»¯ liá»‡u sheet list url cáº§n crawl": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Truy cáº­p vÃ o link láº¥y ra cÃ´ng viá»‡c": {
      "main": [
        [
          {
            "node": "ThÃªm Ä‘á»¯ liá»‡u vÃ o sheet list link tuyá»ƒn dá»¥ng",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ThÃªm Ä‘á»¯ liá»‡u vÃ o sheet list link tuyá»ƒn dá»¥ng": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ThÃªm Ä‘á»¯ liá»‡u vÃ o sheet danh sÃ¡ch cÃ´ng viá»‡c Ä‘Ã£ crawl": {
      "main": [
        [
          {
            "node": "Láº·p láº¡i xá»­ lÃ½",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Láº·p láº¡i xá»­ lÃ½": {
      "main": [
        [],
        [
          {
            "node": "Puppeteer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Láº·p láº¡i xá»­ lÃ½",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Truy cáº­p vÃ o link láº¥y ra cÃ´ng viá»‡c",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Puppeteer": {
      "main": [
        [
          {
            "node": "ThÃªm Ä‘á»¯ liá»‡u vÃ o sheet danh sÃ¡ch cÃ´ng viá»‡c Ä‘Ã£ crawl",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "cf2bd192-29ec-4852-9761-f47e08793fef",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "be4bd479f567f96620153db3fcd673abbd059c76f34103f7251e61fb5e9ec621"
  },
  "id": "QNZIXG49gtXSI6sB",
  "tags": []
}